<%= stylesheet_link_tag "jquery-ui.css" %>  
<%= javascript_include_tag "jquery-ui-min.js" %>
<%= javascript_include_tag "jquery.ibutton", :cache => true %>
<%= stylesheet_link_tag "jquery.ibutton" %>  

  <script type="text/javascript">

    function debug(){ if( window.console && window.console.log ) console.log(arguments); }

  // on DOM ready
      $(document).ready(function (){

        // Hide recorded charges by default
        $('.patient_charge').each(function(){
          if($(this).find('.recorded').text()=="true"){$(this).hide();  }
        });
          
        $(".group").iButton({
          init: function (){
            debug("init", arguments);
          }, 
          change: function (){
            if ($('#ex02').attr('checked')) {
              console.info("Hide Toggle");
              var is_checked = true;
              $('.patient_charge').each(function(){
                if($(this).find('.recorded').text()=="true"){ $(this).hide(); }
              });
            }else{
              console.info("Show Toggle");
              var is_checked = false;
              $('.patient_charge').each(function(){
                if($(this).find('.recorded').text()=="true"){   $(this).show(); }
              });
            }
          }
        });
        
        $(".record_charge_button").click(function(){
          var record_edited=new Object();
          record_edited.charge_id = $(this).parents().find('.patient_name').attr('patientId');
//          record_edited.charge_id = $(this).parents().find('.charge_id').first().text();
          
          console.log(record_edited.charge_id)
          if($(this).parents().find('.recorded').first().text()=="true"){
            $(this).parents().find('.recorded').first().text("false");
            console.log("@@false"); 
            record_edited.is_recorded = false
          }
          else{
            console.log("@@ true");
            $(this).parents().find('.recorded').first().text("true");
            record_edited.is_recorded = true
          }
          $.ajax({
            type: "POST",
            url: "/charges/update_charge_status",
            data: "charge_status="+record_edited.is_recorded+"&charge_id="+record_edited.charge_id,
            success: function(msg){
              console.info( "Data Saved: " + msg );
            }
          });
        });
        $("#ex10")  // attach the iButton behavior
        .iButton({
          labelOn: "Off",
          labelOff: "On"
        })      // trigger the change event (to update the text)
      .trigger("change");
    });

    $("#button_test").click(function(){
      $('.patient_charge').each(function(){
        if($(this).find('.recorded').text()=="true"){$(this).hide();  }
      });
    });

  </script>

      <div id="user_id" class="user_id">
          <% if current_doctor %>
            <%= link_to "Home", :controller => "home", :action => "index"%> 
            <%= link_to "Logout", logout_path %>
          <% else %>
           <!-- <%= link_to "Register", new_doctor_path%>|-->
            <%= link_to "Login", login_path%>
            <%= link_to "Home", :controller => "home", :action => "index"%>
         <%end%>
       </div>
      <!-- Date Search Functions 
         <script type="text/javascript" charset="utf-8">
           $(function(){  
               $('#search_created_at_gte').datepicker({ dateFormat: 'yy-mm-dd' }); 
               $('#search_created_at_lte').datepicker({ dateFormat: 'yy-mm-dd' });
           });
         </script>
         Date Search Form 
 
        End date search Form 
        -->

        <div id="simple" class="group">
          <div class="row">
            <input type="checkbox" id="ex02" checked="checked" />     
            <label class="label" for="ex02">Only Show Unbilled</label><br><br><br>
          </div>
        </div>

        <a class="button" href="/reports/search/last/hour"><span>Last  Hour</span></a><br/><br/>
        <a class="button" href="/reports/search/last/day"><span>Last   Day</span></a><br/><br/>
        <a class="button" href="/reports/search/last/week"><span>Last  Week</span></a><br/><br/>
        <a class="button" href="/reports/search/last/month"><span>Last Month</span></a><br/><br/>
        <a class="button" href="/reports/search/last/year"><span>Last Year</span></a> <br/><br/>
        <a class="button" href="/reports"><span>All</span></a>

        <div id="reports">
          <table>
            <tr>
              <td>
                <table class='stripeMe'>
                  <caption>Patient Charges</caption>
                  <thead>
                    <tr class='odd'>
                      <th><%= sort_link @search,:paitent_name,"Paitent Name" %></th>
                      <th><%= sort_link @search,:procedure_name,"Procedure Name" %></th>
                      <th><%= sort_link @search,:procedure_code,"Code" %></th>
                      <th><%= sort_link @search,:doctor,"Doctor" %></th>
                      <th><%= sort_link @search,:fin,"FIN" %></th>
                      <th><%= sort_link @search,:created_at,"Date Charged"%></th>
                      <th><%= sort_link @search,:recorded,"Billed?"%></th>
                      <th></th>
                    </tr>
                  </thead>
                  <!-- <div id="current_reading"> -->

                    <%= render :partial => "charges", :collection => @charges %>

                  </table>
                  <!-- </div> -->
                </td>
              </tr>
            </table>
          </div>